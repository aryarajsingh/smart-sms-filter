name: Sync Documentation

on:
  push:
    branches: [ master, main ]
    paths:
      - 'android/README.md'
      - 'android/CHANGELOG.md'
  workflow_dispatch:

jobs:
  sync-docs:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Sync documentation files
      shell: bash
      run: |
        echo "Syncing documentation from android/ to root..."
        
        # Create README.md with proper header and content
        {
          echo "<!-- This file is auto-generated from android/README.md. Do not edit directly. -->"
          echo "<!-- Last synchronized: $(date -u +'%Y-%m-%d %H:%M:%S UTC') -->"
          echo ""
          cat android/README.md
          echo ""
          echo ""
          echo "## 📁 Project Structure"
          echo ""
          echo "The main Android application is located in the android/ directory. All development should be done there."
          echo ""
          echo "    smart-sms-filter/"
          echo "    |-- android/          # Main Android application"
          echo "    |   |-- app/         # Application module"
          echo "    |   |-- gradle/      # Gradle wrapper"
          echo "    |   \`-- README.md    # Source documentation (edit this)"
          echo "    |-- docs/            # Additional documentation"
          echo "    |-- models/          # ML models (future)"
          echo "    |-- scripts/         # Utility scripts"
          echo "    \`-- README.md        # Auto-synced from android/README.md"
          echo ""
          echo "> **Note:** Always edit documentation in android/ directory. Root files are auto-synchronized."
        } > README.md
        
        # Copy CHANGELOG
        cp android/CHANGELOG.md CHANGELOG.md
        
        echo "Documentation sync complete"
    
    - name: Check for changes
      id: git-check
      run: |
        git diff --exit-code || echo "changed=true" >> $GITHUB_OUTPUT
    
    - name: Commit and push if changed
      if: steps.git-check.outputs.changed == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md CHANGELOG.md
        git commit -m "docs: Auto-sync documentation from android directory [skip ci]"
        git push